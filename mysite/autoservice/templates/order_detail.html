{% extends "base.html" %}
{% load static %}

{% block heading %}Užsakymo detalė{% endblock %}

{% block content %}
<h2>Užsakymas #{{ order.id }}</h2>

<p><b>Data:</b> {{ order.date }}</p>
<p><b>Automobilis:</b> {{ order.car }}</p>
<p><b>Statusas:</b> {{ order.get_status_display }}</p>

<hr>

<h4>Užsakymo eilutės</h4>
<table class="table">
  <thead>
    <tr>
      <th>Paslauga</th>
      <th>Kiekis</th>
      <th>Kaina</th>
      <th>Suma</th>
    </tr>
  </thead>
  <tbody>
    {% for line in lines %}
      <tr>
        <td>{{ line.service }}</td>
        <td>{{ line.quantity }}</td>
        <td>{% if line.service %}{{ line.service.price|floatformat:2 }} €{% else %}-{% endif %}</td>
        <td>{{ line.line_sum|floatformat:2 }} €</td>
      </tr>
    {% empty %}
      <tr><td colspan="4">Nėra eilučių</td></tr>
    {% endfor %}
  </tbody>
</table>

<h4 class="text-right mt-3">
    Bendra suma: {{ order.total|floatformat:2 }} €
</h4>

<hr>

<h4>Atsiliepimai</h4>
{% for review in reviews %}
<div class="card mb-2">
    <div class="card-body d-flex">
        <div class="mr-3">
            {% if review.reviewer.photo %}
                <img src="{{ review.reviewer.photo.url }}" class="rounded-circle" style="width: 50px; height: 50px; object-fit: cover;">
            {% else %}
                <img src="{% static 'img/undraw_profile.svg' %}" class="rounded-circle" style="width: 50px; height: 50px;">
            {% endif %}
        </div>
        <div>
            <p class="card-text mb-1">{{ review.content }}</p>
            <small class="text-muted">
                <strong>{{ review.reviewer }}</strong> | {{ review.date_created }}
            </small>
        </div>
    </div>
</div>
{% empty %}
<p class="text-muted">Kol kas nėra atsiliepimų.</p>
{% endfor %}

{% if user.is_authenticated %}
<h5 class="mt-4">Palikite atsiliepimą</h5>
<form method="post" class="mb-3">
    {% csrf_token %}
    {% load crispy_forms_tags %}
    {{ form | crispy }}
    <button type="submit" class="btn btn-primary">Paskelbti</button>
</form>
{% else %}
<p class="text-muted mt-3"><a href="{% url 'login' %}">Prisijunkite</a>, kad galėtumėte palikti atsiliepimą.</p>
{% endif %}

<a href="{% url 'autoservice:order-list' %}">← Atgal į užsakymus</a>
{% endblock %}